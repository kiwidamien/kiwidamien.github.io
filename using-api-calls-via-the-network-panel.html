<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Using API calls via the Network Panel</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
  <link href="https://kiwidamien.github.io" rel="canonical" />

  <!-- Feed -->

  <link href="https://kiwidamien.github.io/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="https://kiwidamien.github.io/theme/css/code_blocks/monokai.css" rel="stylesheet">

    <!-- CSS specified by the user -->
    <link href="https://kiwidamien.github.io/assets/css/mystyle.css" type="text/css" rel="stylesheet" />

  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->


    <link href="https://kiwidamien.github.io/using-api-calls-via-the-network-panel.html" rel="canonical" />

        <meta name="description" content="Second article in the advanced web-scraping series. Clarifies the difference between static and dynamic pages. Shows how to use Chrome's...">

        <meta name="author" content="Damien Martin">

        <meta name="tags" content="Scraping">
        <meta name="tags" content="API">
        <meta name="tags" content="Network Panel">

        <meta property="og:locale" content="" />
    <meta property="og:site_name" content="Stacked Turtles" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Stacked Turtles" />
    <meta property="og:description" content="View the blog." />
    <meta property="og:url" content="https://kiwidamien.github.io" />
      <meta property="og:image" content="https://kiwidamien.github.io/assets/images/tools.png" />

  <meta property="og:type" content="article">
            <meta property="article:author" content="https://kiwidamien.github.io/author/damien-martin.html">
  <meta property="og:url" content="https://kiwidamien.github.io/using-api-calls-via-the-network-panel.html">
  <meta property="og:title" content="Using API calls via the Network Panel">
  <meta property="article:published_time" content="2018-10-16 16:00:00-07:00">
            <meta property="og:description" content="Second article in the advanced web-scraping series. Clarifies the difference between static and dynamic pages. Shows how to use Chrome's...">

            <meta propery="og:image" content="https://kiwidamien.github.io/assets/images/cover_background/web_background.svg">
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>
          <li><a href="https://kiwidamien.github.io/about.html" role="presentation">About this blog</a></li>
          <li><a href="http://slashdot.org" role="presentation">slashdot</a></li>
          <li><a href="https://thisismetis.com" role="presentation">metis</a></li>
          <li><a href="https://stackoverflow.com" role="presentation">stackoverflow</a></li>


    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" class="has-cover">
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="https://kiwidamien.github.io" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Using API calls via the Network Panel</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="https://kiwidamien.github.io/author/damien-martin.html">Damien martin</a>
            | <time datetime="Tue 16 October 2018">Tue 16 October 2018</time>
        </span>
        <span class="post-meta">
          Filed under: <b><a href="https://kiwidamien.github.io/category/web.html">Web</a></b>
        </span>

        <!-- TODO : Modified check -->


    <div class="post-cover cover"
      style="background-image: url('assets/images/cover_background/web_background.svg'); background-repeat: repeat; background-size: 100px 100px; background-color: rgb(240,180,82);">
      <div class="logoimg">
        <img src='https://kiwidamien.github.io/assets/images/icon/turtle.svg'/>
      </div>
      <div class="logoimg">
        <img src='assets/images/icon/web_icon.png'/>
      </div>

</div>
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
		    <p>This post is part 2 of the "Advanced Scraping" series:</p>
    		    <ol class="parts">
            	        <li >
                          <a href='https://kiwidamien.github.io/webscraping-beyond-beautifulsoup-and-selenium.html'>Webscraping beyond BeautifulSoup and Selenium</a>
                        </li>
            	        <li class="active">
                          <a href='https://kiwidamien.github.io/using-api-calls-via-the-network-panel.html'>Using API calls via the Network Panel</a>
                        </li>
                    </ol>
                <p>In the first article in this series, we looked at the two standard ways of scraping sites:</p>
<ol>
<li>Using a parser such as BeautifulSoup for static sites</li>
<li>Using Selenium to execute Javascript on a dynamic site. Once Javascript has rendered the site, use a parser to extract the information.</li>
</ol>
<p>On many websites, the Javascript executed by the browser makes requests from another server to get the information and process into HTML. In this installment, we investigate how to discover these network calls using Chrome's Network Panel in the Developer Tools.</p>
<p>We will look at three examples:</p>
<ul>
<li>Getting customer reviews of lipsticks from Sephora</li>
<li>A mock site</li>
<li>Getting a list of job openings at Apple</li>
</ul>
<h2>Sephora lipstick reviews</h2>
<p>One of my students at Metis did a project where she clustered <a href="https://mayamadhavan.github.io/2018/09/30/project-fletcher/">Sephora lipsticks by similarity</a>, using not only the features claimed by Sephora, but also the reviews of the different lipsticks. To do this, she had to scrape the reviews from the individual lipsticks sold.</p>
<p>Here is an example of a <a href="https://www.sephora.com/product/stunna-lip-paint-P39787544?icid2=products%20grid:p39787544:product">typical lipstick page</a>. If you visit that page, you may note that there is a link "Show 6 more reviews" at the bottom of the page that allows us to (slowly) make our way through the review. Here is a screen shot including a review:</p>
<p><img alt='Some Sephora review with link to more review' src='images/scraping/sephora/sephora_review.png' style="width:80%; margin: 0 auto;"/></p>
<p>Investigating the "link", we see that it is actually a button (operated by Javascript). We want to find a way of getting the reviews without having to start Selenium.</p>
<h3>Open the Network tab</h3>
<p>Open the <a href="https://www.sephora.com/product/stunna-lip-paint-P39787544?icid2=products%20grid:p39787544:product">page</a> for this lipstick in Chrome. You can access this from the menu bar: <strong>View -&gt; Developer -&gt; Developer Tools</strong>. This will open the Developer tools on the right. Now click "Network" on the top.</p>
<p><img alt="The network tools" src="images/scraping/sephora/network.png"></p>
<p>You should see a list of files that have been downloaded by this page (shown in the box under "Name"). If there is nothing there, refresh the page.</p>
<h3>Using the Network tab</h3>
<p>The network panel shows the different files downloaded by the browser when opening the page. For example, if you include an image tag <code>&lt;img src="some_image.png"/&gt;</code> in your HTML, the browser has to download <code>some_image.png</code>. Then <code>some_image.png</code> will be recorded in the Network panel.</p>
<p>We are interested in whether we can find the reviews as something the page downloaded. Let's take some text from a review, and search for objects that have been downloaded with this string in it. Click on the magnifying glass (boxed in red), and copy the text <code>"This is a gorgeous universal red, as it dries and turns matte"</code> from one of the reviews into the search box:</p>
<p><img alt="Finding the file that contains the review" src="images/scraping/sephora/search_review.png"></p>
<p>We see <code>reviews.json</code> contains the review text we are looking for. We can search for the <code>review.json</code> request using the <em>other</em> search box in the Network tab</p>
<p><img alt='Finding reviews.json' src='images/scraping/sephora/find_reviews.png' style="width:80%; margin: 0 auto;"/></p>
<p>Looking at the header (at the top, not shown) we see the URL used to get <code>review.json</code> is</p>
<div class="highlight"><pre><span></span>https://api.bazaarvoice.com/data/reviews.json?Filter<span class="o">=</span>ProductId%3AP39787544<span class="p">&amp;</span><span class="nv">Sort</span><span class="o">=</span>Helpfulness%3Adesc<span class="p">&amp;</span><span class="nv">Limit</span><span class="o">=</span><span class="m">30</span><span class="p">&amp;</span><span class="nv">Offset</span><span class="o">=</span><span class="m">0</span><span class="p">&amp;</span><span class="nv">Include</span><span class="o">=</span>Products%2CComments<span class="p">&amp;</span><span class="nv">Stats</span><span class="o">=</span>Reviews<span class="p">&amp;</span><span class="nv">passkey</span><span class="o">=</span>rwbw526r2e7spptqd2qzbkp7<span class="p">&amp;</span><span class="nv">apiversion</span><span class="o">=</span><span class="m">5</span>.4
</pre></div>


<p>This URL is a long and ugly, and has encoded parts (e.g. <code>Sort=Helpfulness%3Adesc</code>, where <code>%3A</code> is the HTML encoding for the standard colon). If we scroll to the bottom, we can find the query string parameters formatted nicely. We can put these in a standard Python dictionary:</p>
<div class="highlight"><pre><span></span><span class="c1"># These are the parameters used to get the first 30 reviews</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;Filter&#39;</span><span class="p">:</span> <span class="s1">&#39;ProductId:P39787544&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Sort&#39;</span><span class="p">:</span> <span class="s1">&#39;Helpfulness:desc&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Limit&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="s1">&#39;Offset&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;Include&#39;</span><span class="p">:</span> <span class="s1">&#39;Products,Comments&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Stats&#39;</span><span class="p">:</span> <span class="s1">&#39;Reviews&#39;</span><span class="p">,</span>
  <span class="s1">&#39;passkey&#39;</span><span class="p">:</span> <span class="s1">&#39;rwbw526r2e7spptqd2qzbkp7&#39;</span><span class="p">,</span>
  <span class="s1">&#39;apiversion&#39;</span><span class="p">:</span> <span class="mf">5.4</span>
<span class="p">}</span>
</pre></div>


<p>We can also see the object returned from this request by looking at the <code>Preview</code> menu (located next to <code>Header</code>). We see that a JSON object is returned (in Python, this will be a dictionary). The reviews are held as a list of dictionaries in the field <code>Results</code>. Only the first 30 reviews are included (as determined by <code>offset</code> and <code>limit</code>). Notice that the total number of reviews is also stored in the field <code>TotalResults</code>.</p>
<h3>The python code to get all the reviews</h3>
<p>Here is the code for getting all the data about the reviews for this lipstick:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.bazaarvoice.com/data/reviews.json&#39;</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;Filter&#39;</span><span class="p">:</span> <span class="s1">&#39;ProductId:P39787544&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Sort&#39;</span><span class="p">:</span> <span class="s1">&#39;Helpfulness:desc&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Limit&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="s1">&#39;Offset&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;Include&#39;</span><span class="p">:</span> <span class="s1">&#39;Products,Comments&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Stats&#39;</span><span class="p">:</span> <span class="s1">&#39;Reviews&#39;</span><span class="p">,</span>
  <span class="s1">&#39;passkey&#39;</span><span class="p">:</span> <span class="s1">&#39;rwbw526r2e7spptqd2qzbkp7&#39;</span><span class="p">,</span>
  <span class="s1">&#39;apiversion&#39;</span><span class="p">:</span> <span class="mf">5.4</span>
<span class="p">}</span>

<span class="n">reviews</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">loop</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
  <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span>

  <span class="c1"># Make the same request that Javascript makes</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

  <span class="c1"># break if we have an error or have all the reviews</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;TotalResults&#39;</span><span class="p">]):</span>
    <span class="k">break</span>

  <span class="c1"># add the list of results to current results</span>
  <span class="n">reviews</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;Results&#39;</span><span class="p">])</span>

  <span class="c1"># Give a pause, so we don&#39;t get blocked</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Show how many reviews we scraped</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reviews</span><span class="p">))</span>
</pre></div>


<p>This script downloaded all the reviews (including star ratings, user names, skin color of reviewer, review text, ...) in about 1 minute and 48 seconds. The JSON objects I received back would be ready for me to store directly into MongoDB for later processing.</p>
<h2>A mock site</h2>
<p>One problem with writing tutorials using company websites is that websites change. Frequently. The site <a href="https://scapethissite.com/">https://scapethissite.com/</a> is setup to help you hone your scraping skills. We will look at the AJAX loading site <a href="https://scrapethissite.com/pages/ajax-javascript/#2015">https://scrapethissite.com/pages/ajax-javascript/#2015</a>. Our goal is to grab the table of Oscar winning movies.</p>
<p><img src='images/scraping/oscars.png' style='width:60%; margin: 0 auto;'/></p>
<p>Here are our steps:</p>
<ol>
<li>Open the network panel</li>
<li>Search for <code>'Spotlight'</code> (the name of the best picture, unlikely to appear other places in the site).</li>
<li>Find that the request is in <code>scrapethissite.com/pages/ajax-javascript/?ajax=true&amp;year=2015</code></li>
<li>Search for the script named <code>?ajax=true&amp;year=2015</code>. This is tricky to find! Look at the response, and see that we have the JSON object we want.</li>
</ol>
<p>Now we are ready to put together our script:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://scrapethissite.com/pages/ajax-javascript/&#39;</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ajax&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">}</span>  <span class="c1"># Note - use string &#39;true&#39;, not Python&#39;s True</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre></div>


<p>This returns</p>
<div class="highlight"><pre><span></span><span class="p">[{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;best_picture&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span><span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Spotlight  &#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mad Max: Fury Road &#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Revenant   &#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Bridge of Spies&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Big Short  &#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Danish Girl&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Room   &#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Ex Machina &#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Hateful Eight  &#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Inside Out &#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Amy&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Bear Story &#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;A Girl in the River: The Price of Forgiveness  &#39;</span><span class="p">,</span>
  <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Son of Saul&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Spectre&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;awards&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nominations&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Stutterer  &#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">}]</span>
</pre></div>


<h2>Scraping Jobs on Apple's website</h2>
<p>As our final example, let's get a listing of open jobs Apple is posting. Apple hosts their open positions at https://jobs.apple.com/us/search.</p>
<p>Our steps should be familiar:</p>
<ol>
<li>Open the Network panel, and go to https://jobs.apple.com/us/search</li>
<li>Search for a job title (I searched for <code>US-Creative</code>, which was a posting at the time)</li>
<li>Find the request is in <code>jobs.apple.com/us/search/search-result</code></li>
<li>Search for <code>search-result</code> in the list of network requests.</li>
</ol>
<p>Here is a screenshot from the network panel.</p>
<p><img src='images/scraping/apple/apple_network_response.png' style='width:60%; margin: 0 auto;' /></p>
<p>Notice a few differences:</p>
<ul>
<li>This is a POST request, not a GET request.</li>
<li>There is a <code>Form Data</code> section (this is what we are posting)</li>
<li>There are lots of Request Headers (15, collapsed in diagram)</li>
<li>When looking at the <code>Preview</code> of the response, we get XML, not JSON.</li>
</ul>
<p>Here are the changes we have to make:</p>
<ul>
<li>There is no query string (i.e. no <code>?......</code> at the end of the URL). We don't need <code>params</code> in this case.</li>
<li>We might need to encode a dictionary for the <code>header</code>. We will try without it to see if it works (it will in this case).</li>
<li>The form data gets passed in as <code>data</code>, not <code>params</code>.</li>
<li>We will need to access the XML from <code>r.text</code>, as there is no <code>r.json()</code> returned.</li>
</ul>
<p>Let's see this in action:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://jobs.apple.com/us/search/search-result&#39;</span>
<span class="n">searchRequestField</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;jobType&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;sortBy&#39;</span><span class="p">:</span> <span class="s1">&#39;req_open_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;sortOrder&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;locations&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;USA&#39;</span><span class="p">}]}</span>
    <span class="p">},</span>
  <span class="s1">&#39;pageNumber&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
<span class="p">}</span>

<span class="c1"># Note that field &#39;searchRequestJson&#39; has to be a JSON string</span>
<span class="c1"># Requests will NOT convert the python dictionary for you =(</span>
<span class="n">form_data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;searchRequestJson&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">searchRequestField</span><span class="p">),</span>
  <span class="s1">&#39;clientOffset&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">480</span>
<span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">form_data</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>


<p>I have added some formatting to make the structure a little cleaner, but we see the final output is</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
  <span class="nt">&lt;html&gt;&lt;body&gt;&lt;result&gt;</span>
    <span class="nt">&lt;count&gt;</span>3057<span class="nt">&lt;/count&gt;</span>
    <span class="nt">&lt;requisition&gt;</span>
      <span class="nt">&lt;jobfunction&gt;</span>Retail<span class="nt">&lt;/jobfunction&gt;</span>
      <span class="nt">&lt;jobid&gt;</span>USABS<span class="nt">&lt;/jobid&gt;</span>
      <span class="nt">&lt;jobtypecategory&gt;</span>Retail<span class="nt">&lt;/jobtypecategory&gt;</span>
      <span class="nt">&lt;location&gt;</span>Various<span class="nt">&lt;/location&gt;</span>
      <span class="nt">&lt;retailpostingdate&gt;</span>Oct. 16, 2018<span class="nt">&lt;/retailpostingdate&gt;</span>
      <span class="nt">&lt;retailpostingtitle&gt;</span>US-Business Expert<span class="nt">&lt;/retailpostingtitle&gt;</span>
    <span class="nt">&lt;/requisition&gt;</span>
    <span class="nt">&lt;requisition&gt;</span>
      <span class="nt">&lt;jobfunction&gt;</span>Retail<span class="nt">&lt;/jobfunction&gt;</span>
      <span class="nt">&lt;jobid&gt;</span>USACR<span class="nt">&lt;/jobid&gt;</span>
      <span class="nt">&lt;jobtypecategory&gt;</span>Retail<span class="nt">&lt;/jobtypecategory&gt;</span>
      <span class="nt">&lt;location&gt;</span>Various<span class="nt">&lt;/location&gt;</span>
      <span class="nt">&lt;retailpostingdate&gt;</span>Oct. 16, 2018<span class="nt">&lt;/retailpostingdate&gt;</span>
      <span class="nt">&lt;retailpostingtitle&gt;</span>US-Creative<span class="nt">&lt;/retailpostingtitle&gt;</span>
    <span class="nt">&lt;/requisition&gt;</span>.
    ....
  <span class="nt">&lt;/result&gt;&lt;/body&gt;&lt;/html&gt;</span>
</pre></div>


<p>If we wanted to get the job title, posting date, and location from the result, we could parse through BeautifulSoup (note this is a lot more structured than HTML!)</p>
<div class="highlight"><pre><span></span><span class="c1"># assume we have r.text from earlier</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">grabField</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="k">return</span> <span class="n">default</span>

<span class="c1"># grab all requisition tags</span>
<span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;requisition&#39;</span><span class="p">):</span>
  <span class="n">info</span> <span class="o">=</span> <span class="n">grabField</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="s1">&#39;retailpostingtitle&#39;</span><span class="p">,</span> <span class="s1">&#39;no title&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">grabField</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="s1">&#39;retailpostingdate&#39;</span><span class="p">,</span> <span class="s1">&#39;no date&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span>
  <span class="n">info</span> <span class="o">=</span> <span class="n">info</span> <span class="o">+</span> <span class="n">grabField</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;no location&#39;</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
</pre></div>


<p>Of course, instead of printing this information, we could also choose to make store it in a database or dataframe for future analysis.</p>
<h1>Summary</h1>
<p>We looked at three examples of making the network requests manually. The basic steps are:</p>
<ol>
<li>Use the network panel to search for the data.</li>
<li>Find which request the data came from. When you think you have identified it, check the <code>Preview</code> to see if the response to the request is useful.</li>
<li>Look at the <code>Header</code> tab to help figure out how to structure the request. Pay careful attention to whether the request is a GET or POST request.</li>
<li>Make the request using the request library, and then process the resulting JSON or text.</li>
</ol>
<p>Some other things to watch out for:</p>
<ul>
<li>Use <code>params=.....</code> in the request method when passing queries as part of the URL</li>
<li>Use <code>data=.....</code> in the request method when passing in form data</li>
<li>Use <code>headers=.....</code> to pass in header information (but sometimes you don't need to include it)</li>
<li>If some of your methods look like they include dictionaries, it is safer to do pass a JSON string instead. To convert a dictionary <code>dict</code> to a JSON string, use <code>json.dumps(dict)</code>. The Apple job scraping example should get you started.</li>
</ul>
<p>Good luck scraping!</p>
            </section>

            <section class="post-info">
                <div class=a"post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Using API calls via the Network Panel&amp;url=https://kiwidamien.github.io/using-api-calls-via-the-network-panel.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://kiwidamien.github.io/using-api-calls-via-the-network-panel.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=https://kiwidamien.github.io/using-api-calls-via-the-network-panel.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="https://kiwidamien.github.io/tag/scraping.html">Scraping</a><a href="https://kiwidamien.github.io/tag/api.html">API</a><a href="https://kiwidamien.github.io/tag/network-panel.html">Network Panel</a>                </aside>

                <div class="clear"></div>

                <aside class="post-author">
                        <figure class="post-author-avatar">
                            <img src="../assets/images/avatar.png" alt="Damien martin" />
                        </figure>
                    <div class="post-author-bio">
                        <h4 class="post-author-name"><a href="https://kiwidamien.github.io/author/damien-martin.html">Damien martin</a></h4>
                            <p class="post-author-about">I am data scientist with an interest in what drives the world. Background in Physics, Math, and Computer Science. Interested in Algorithms, Games, Books, Music, and Martial Arts. That is, when I am not off taking pictures somewhere! </p>
                            <span class="post-author-location"><i class="ic ic-location"></i> USA</span>
                            <span class="post-author-website"><a href="http://kiwidamien.github.io"><i class="ic ic-link"></i> Website</a></span>
                    </div>
                    <div class="clear"></div>
                </aside>

                </section>


                <aside class="post-nav">
                    <a class="post-nav-prev" href="https://kiwidamien.github.io/webscraping-beyond-beautifulsoup-and-selenium.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-right"></i>
                                <h2 class="post-nav-title">Webscraping beyond BeautifulSoup and Selenium</h2>
                            <p class="post-nav-excerpt">First article in the advanced web-scraping series. Clarifies the difference between...</p>
                        </section>
                    </a>
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>
  
  </section>

  <script type="text/javascript" src="https://kiwidamien.github.io/theme/js/script.js"></script>

</body>
</html>