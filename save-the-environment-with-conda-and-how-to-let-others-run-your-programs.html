<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Save the environment with conda (and how to let others run your programs)</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
  <link href="https://kiwidamien.github.io" rel="canonical" />

  <!-- Feed -->

  <link href="https://kiwidamien.github.io/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="https://kiwidamien.github.io/theme/css/code_blocks/monokai.css" rel="stylesheet">
  
  <link href="https://kiwidamien.github.io/theme/css/code_blocks/notebook.css" rel="stylesheet">

    <!-- CSS specified by the user -->
    <link href="https://kiwidamien.github.io/assets/css/mystyle.css" type="text/css" rel="stylesheet" />


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->


    <link href="https://kiwidamien.github.io/save-the-environment-with-conda-and-how-to-let-others-run-your-programs.html" rel="canonical" />

        <meta name="description" content="Environments allow you to distribute software to other users, where you don't know what packages they have installed. This is a better...">

        <meta name="author" content="Damien Martin">

        <meta name="tags" content="python">
        <meta name="tags" content="engineering">
        <meta name="tags" content="package">
        <meta name="tags" content="best-practices">
        <meta name="tags" content="environment">
        <meta name="tags" content="conda">

        <meta property="og:locale" content="" />
    <meta property="og:site_name" content="Stacked Turtles" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Stacked Turtles" />
    <meta property="og:description" content="View the blog." />
    <meta property="og:url" content="https://kiwidamien.github.io" />
      <meta property="og:image" content="https://kiwidamien.github.io/assets/images/tools.png" />

  <meta property="og:type" content="article">
            <meta property="article:author" content="https://kiwidamien.github.io/author/damien-martin.html">
  <meta property="og:url" content="https://kiwidamien.github.io/save-the-environment-with-conda-and-how-to-let-others-run-your-programs.html">
  <meta property="og:title" content="Save the environment with conda (and how to let others run your programs)">
  <meta property="article:published_time" content="2019-01-22 19:30:00-08:00">
            <meta property="og:description" content="Environments allow you to distribute software to other users, where you don't know what packages they have installed. This is a better...">

            <meta propery="og:image" content="https://kiwidamien.github.io/assets/images/cover_background/tool_background.svg">
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>
          <li><a href="https://kiwidamien.github.io/about.html" role="presentation">About this blog</a></li>
          <li><a href="http://slashdot.org" role="presentation">slashdot</a></li>
          <li><a href="https://thisismetis.com" role="presentation">metis</a></li>
          <li><a href="https://stackoverflow.com" role="presentation">stackoverflow</a></li>


    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" class="has-cover">
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="https://kiwidamien.github.io" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Save the environment with conda (and how to let others run your programs)</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="https://kiwidamien.github.io/author/damien-martin.html">Damien martin</a>
            | <time datetime="Tue 22 January 2019">Tue 22 January 2019</time>
        </span>
        <span class="post-meta">
          Filed under: <b><a href="https://kiwidamien.github.io/category/tools.html">Tools</a></b>
        </span>

        <!-- TODO : Modified check -->


    <div class="post-cover cover"
      style="background-image: url('assets/images/cover_background/tool_background.svg'); background-repeat: repeat; background-size: 100px 100px; background-color: rgb(240,180,82);">
      <div class="logoimg">
        <img src='https://kiwidamien.github.io/assets/images/icon/turtle.svg'/>
      </div>
      <div class="logoimg">
        <img src='assets/images/icon/tool_icon.png'/>
      </div>

</div>
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <h2>Save the environment with conda (and how to let others run your programs)</h2>
<p>If you have been developing in Python, you may have tried to distribute your program to friends and colleagues. It can be mildly annoying when they try to run your program and it fails because they don't have <code>obscurePackage42</code> installed. If you are nearby, then it is easy for you to call <code>pip install</code> a few times and get them started with your program. If you are trying to distribute a program to end users (or even some non-technical executives) then you really want something that is going to work "out of the box".</p>
<p>Using an environment has the additional benefit of having us deal with one specific <em>known</em> version of Python. The problem of "which Python am I using?" is one familiar to many of us.</p>
<p><img alt="Too many Pythons (xkcd/1987)" src="images/environments/python_environment_2x.png"></p>
<h2>The old way (and its drawbacks)</h2>
<p>One way of doing this was to write a <code>requirements.txt</code> file. The format of this file was pretty simple:</p>
<div class="highlight"><pre><span></span><span class="c1"># Installs </span>
<span class="c1"># A version of numpy no older than 1.14.0</span>
<span class="c1"># Exactly the version 0.23.4 of Pandas</span>
numpy&gt;<span class="o">=</span><span class="m">1</span>.14.0
<span class="nv">pandas</span><span class="o">==</span><span class="m">0</span>.23.4
</pre></div>


<p>A single command, <code>pip install -r requirements.txt</code> and everything would be written to the main Python repository. </p>
<p>While simple to use, there are a couple of different problems with this approach:</p>
<ul>
<li><strong>Version conflicts:</strong> What if one application required version <code>0.23.4</code> of Pandas, but a different application required <code>0.19.0</code> (because it used a now deprecated feature)? We would have to reinstall from <code>requirements.txt</code> when switching between these applications.</li>
<li><strong>Tracking dependencies:</strong> It can be difficult to keep track of which packages your application is actually using. You don't want to include all installed packages on your machine, as only a few are relevant to your application.</li>
</ul>
<p>Environments were designed to address both of these issues.</p>
<h2>Environments</h2>
<p>An <em>environment</em> is a way of starting with a new Python installation, that doesn't look at your already installed packages. In this way, it simulates having a fresh install of Python. If two applications require different versions of Python, you can simply create different environments for them. If you start from a fresh environment and install as you go, you are able to generate a list of all packages installed in the environment so that others can easily duplicate it.</p>
<p>There are many different environments and dependency managers in the Python ecosystem. The most common ones in use are <code>virtualenv</code> and <code>conda</code> (but there are others such as <code>poetry</code>, <code>pyenv/pipenv</code>, <code>hatch</code> and many more I haven't heard of). This article is about using <code>conda</code> to manage environments, although all of these tools share the same broad goals. Some of the differences between these tools are touched on in the <strong>Alternatives</strong> section.</p>
<p>There are two steps to using an environment (with a third step needed if you want to use Jupyter notebooks)</p>
<ol>
<li>Creating the environment, either from scratch (a new project) or from a yaml file (duplicating an environment)</li>
<li>Activating the environment for use.</li>
<li>Register the environment with Jupyter.</li>
</ol>
<p>To leave an environment, we have to <em>deactivate</em> it. The quickstart below will walk through the typical workflow.</p>
<h3>Using an environment (quickstart)</h3>
<p>Let's say you wanted to create an environment <code>test_env</code> to do some testing with Python 3.6, and install numpy and Pandas. At the terminal, type the following:</p>
<div class="highlight"><pre><span></span><span class="c1"># create the (empty) environment</span>
$ conda create --name test_env <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.6

<span class="c1"># activate the environment</span>
$ <span class="nb">source</span> activate test_env

<span class="c1"># Now in the new environment, install the packages.</span>
<span class="c1"># Note the prompt will (typically) tell you about the environment</span>
<span class="o">(</span>test_env<span class="o">)</span> $ conda install numpy pandas
</pre></div>


<p>If you want Jupyter notebooks to see your new environment, you need a couple of extra instructions. Jupyter sees the different environments as different <em>kernels</em>. Once we create a new environment, we need to tell Jupyter that it is there:</p>
<div class="highlight"><pre><span></span><span class="c1"># Note you&#39;ll want to do this in the new environment.</span>
<span class="c1"># First we will need the ipykernel package</span>
<span class="o">(</span>test_env<span class="o">)</span> $ conda install ipykernel

<span class="c1"># This tells jupyter to take the current environment (test_env)</span>
<span class="c1"># and make a &quot;kernel&quot; option named &quot;test kernel&quot; in the </span>
<span class="c1"># kernel menu</span>
<span class="o">(</span>test_env<span class="o">)</span> $ python -m ipykernel install --user --name myenv --display-name <span class="s2">&quot;test kernel&quot;</span>
</pre></div>


<p>When loading a jupyter notebook, you can use the menu options <strong>Kernel-&gt;Change Kernel-&gt;test kernel</strong> to ensure you are using the <code>test_env</code> environment.</p>
<p>Now you want to make an <code>environment.yaml</code> file that will allow others to recreate the environment from scratch. To make this file, we use the <code>export</code> command and send the output to <code>environment.yaml</code>:</p>
<div class="highlight"><pre><span></span><span class="c1"># while in test_env, export the packages used to an environment file</span>
<span class="o">(</span>test_env<span class="o">)</span> $ conda env <span class="nb">export</span> &gt; environment.yaml
</pre></div>


<p>Once we are done with the environment, we can deactivate and delete the environment:</p>
<div class="highlight"><pre><span></span><span class="c1"># Leave the environment</span>
<span class="o">(</span>test_env<span class="o">)</span> $ <span class="nb">source</span> deactivate

<span class="c1"># Now we are no longer in test_env, we can delete it</span>
$ conda env remove --name test_env
</pre></div>


<h3>Making the environment again from the yaml file</h3>
<p>If you have the yaml file (created from <code>conda env export</code>), then recreating the environment is a single command:</p>
<div class="highlight"><pre><span></span>$ conda env create --file environment.yaml
</pre></div>


<p>Note that you don't need to supply the name of the new environment, as the yaml file also contains the name of the environment it saved. Make sure you don't give your environment an embarassing name, as everyone who recreates from the yaml file will see the name you used!</p>
<h3>Finding conda environments on your system</h3>
<p>Of course, you may choose to deactivate your environment but keep it around for later. If you want to see the environments installed on your system, use </p>
<div class="highlight"><pre><span></span>$ conda env list
</pre></div>


<h2>Useful commands</h2>
<p>Here is a brief summary of useful commands for environemnts. Anaconda has also published a <a href="https://conda.io/docs/_downloads/conda-cheatsheet.pdf">cheat sheet</a> with a more extensive list of useful commands.</p>
<table>
<thead>
<tr>
<th></th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create a new environment <code>ENV_NAME</code> with Python version 3.X</td>
<td><code>conda create --name ENV_NAME python=3.X</code></td>
</tr>
<tr>
<td>Create a new environment <code>ENV_NAME</code> with some initial packages</td>
<td><code>conda create --name ENV_NAME python=3.X pandas ipykernel</code></td>
</tr>
<tr>
<td>Create a new environment from a yaml file</td>
<td><code>conda env create --file environment.yaml</code></td>
</tr>
<tr>
<td>Activate the environment <code>ENV_NAME</code> (OSX, Linux)</td>
<td><code>source activate ENV_NAME</code></td>
</tr>
<tr>
<td>Activate the environment <code>ENV_NAME</code> (Windows)</td>
<td><code>activate ENV_NAME</code></td>
</tr>
<tr>
<td>Deactivate the current environment (*)</td>
<td><code>source deactivate</code></td>
</tr>
<tr>
<td>Delete the environment <code>ENV_NAME</code></td>
<td><code>conda env remove --name ENV_NAME</code></td>
</tr>
<tr>
<td>List all installed environments</td>
<td><code>conda env list</code></td>
</tr>
<tr>
<td>Create a YAML file for active environment(*)</td>
<td><code>conda env export &gt; environment.yaml</code></td>
</tr>
</tbody>
</table>
<p>The commands with (*) require you to have the environment active before using them. The naming is a little odd for creating environments: if creating them yourself the command is <code>conda create .....</code>, but if creating them from a yaml file we use <code>conda env create ......</code>. This is not a typo!</p>
<h2>Tip for maximizing portability</h2>
<p>Some packages are system dependent (e.g. the Python Image Library <code>Pillow</code> is used by OSX and Linux, but not Windows). Once you create your <code>environment.yaml</code> file, it is often a good idea to eliminate packages you don't use directly. For example, if you tell conda to install <code>pandas</code> but not <code>numpy</code> it will figure out it needs <code>numpy</code> for <code>pandas</code> to work. You should aim to eliminate all the packages in <code>environment.yaml</code> except the ones you actually import, so that conda can figure out which other packages are needed for the user's system (which may be running a different operating system to yours).</p>
<h2>Summary</h2>
<p>Creating environments allow us to make sure users we distribute our code to have the right packages (and the right versions of those packages installed) to run our code, without interfering with other programs. We <em>activate</em> and environment to start using it, and <em>deactivate</em> to leave again. </p>
<p>If making a new environment that you want others to use, the workflow is</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">conda</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">ENV_NAME</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.</span><span class="n">X</span> <span class="o">&lt;</span><span class="n">packages</span> <span class="n">to</span> <span class="n">install</span><span class="o">&gt;</span>
<span class="err">$</span> <span class="n">source</span> <span class="n">activate</span> <span class="n">ENV_NAME</span>
<span class="p">(</span><span class="n">ENV_NAME</span><span class="p">)</span><span class="err">$</span> <span class="o">......</span> <span class="n">do</span> <span class="n">stuff</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">write</span> <span class="n">code</span><span class="p">,</span> <span class="n">conda</span> <span class="n">install</span> <span class="n">more</span> <span class="n">packages</span><span class="p">)</span>
<span class="p">(</span><span class="n">ENV_NAME</span><span class="p">)</span><span class="err">$</span> <span class="n">conda</span> <span class="n">env</span> <span class="n">export</span> <span class="o">&gt;</span> <span class="n">environment</span><span class="o">.</span><span class="n">yaml</span>
<span class="p">(</span><span class="n">ENV_NAME</span><span class="p">)</span><span class="err">$</span> <span class="n">source</span> <span class="n">deactivate</span>
<span class="c1"># back to regular shell</span>
<span class="err">$</span>
</pre></div>


<p>If you are using an environment someone else has created:</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">conda</span> <span class="n">env</span> <span class="n">create</span> <span class="o">--</span><span class="nb">file</span> <span class="n">environment</span><span class="o">.</span><span class="n">yaml</span>
<span class="err">$</span> <span class="n">source</span> <span class="n">activate</span> <span class="n">ENV_NAME</span>
<span class="p">(</span><span class="n">ENV_NAME</span><span class="p">)</span><span class="err">$</span> <span class="o">.....</span> <span class="n">do</span> <span class="n">stuff</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">run</span> <span class="n">program</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">this</span> <span class="n">environment</span><span class="p">)</span>
<span class="err">$</span> <span class="n">source</span> <span class="n">deactivate</span>
</pre></div>


<h3>Alternatives</h3>
<ul>
<li>The original virtualenv. As the Jake VanderPlas article <a href="https://jakevdp.github.io/blog/2016/08/25/conda-myths-and-misconceptions/">"Conda: Myths and Misconceptions"</a> points out, these are mostly interchangle if you are only installing python packages into your environment. In slightly more detail<ul>
<li><code>virtualenv/pip</code> installs python packages into <em>any</em> environment, while</li>
<li><code>conda</code> installs <em>any</em> packages into <em>conda</em> environments.</li>
</ul>
</li>
</ul>
<p>If you are solely installing Python packages, there is not much difference between the two.</p>
<ul>
<li><a href="https://pipenv.readthedocs.io/en/latest/"><code>pyenv/pipenv</code></a> by Kenneth Reitz. The main goal of this project was to automate/simplify environment creation, but is not as mature as either <code>virtualenv</code> or <code>conda</code> solutions.</li>
<li><a href="https://poetry.eustace.io/"><code>poetry</code></a> by Sébastien Eustace, which aims to be a packaging and deployment tool.</li>
</ul>
<p>With the exception of <code>virtualenv</code>, none of these solutions are as mature as <code>conda</code>. This is a piece of the Python that will hopefully improve and simplify, but for now, Randall Munroe's XKCD comic puts it well.</p>
            </section>

            <section class="post-info">
                <div class=a"post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Save the environment with conda (and how to let others run your programs)&amp;url=https://kiwidamien.github.io/save-the-environment-with-conda-and-how-to-let-others-run-your-programs.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://kiwidamien.github.io/save-the-environment-with-conda-and-how-to-let-others-run-your-programs.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=https://kiwidamien.github.io/save-the-environment-with-conda-and-how-to-let-others-run-your-programs.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="https://kiwidamien.github.io/tag/python.html">python</a><a href="https://kiwidamien.github.io/tag/engineering.html">engineering</a><a href="https://kiwidamien.github.io/tag/package.html">package</a><a href="https://kiwidamien.github.io/tag/best-practices.html">best-practices</a><a href="https://kiwidamien.github.io/tag/environment.html">environment</a><a href="https://kiwidamien.github.io/tag/conda.html">conda</a>                </aside>

                <div class="clear"></div>

                <aside class="post-author">
                        <figure class="post-author-avatar">
                            <img src="../assets/images/avatar.png" alt="Damien martin" />
                        </figure>
                    <div class="post-author-bio">
                        <h4 class="post-author-name"><a href="https://kiwidamien.github.io/author/damien-martin.html">Damien martin</a></h4>
                            <p class="post-author-about">I am a data scientist with an interest in what drives the world. Background in Physics, Math, and Computer Science. Interested in Algorithms, Games, Books, Music, and Martial Arts. That is, when I am not off taking pictures somewhere! </p>
                            <span class="post-author-location"><i class="ic ic-location"></i> USA</span>
                            <span class="post-author-website"><a href="http://kiwidamien.github.io"><i class="ic ic-link"></i> Website</a></span>
                    </div>
                    <div class="clear"></div>
                </aside>

                </section>


                <aside class="post-nav">
                    <a class="post-nav-next" href="https://kiwidamien.github.io/prevent-big-commits.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-left"></i>
                                <h2 class="post-nav-title">Prevent big commits</h2>
                            <p class="post-nav-excerpt">Instead of learning how to undo accidentally commiting a large file, what if we could...</p>
                        </section>
                    </a>
                    <a class="post-nav-prev" href="https://kiwidamien.github.io/making-a-python-package-viii-summary.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-right"></i>
                                <h2 class="post-nav-title">Making a Python Package VIII - summary</h2>
                            <p class="post-nav-excerpt">This is the eighth in a series of blog posts where we go through the process of taking...</p>
                        </section>
                    </a>
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>
  
  </section>

  <script type="text/javascript" src="https://kiwidamien.github.io/theme/js/script.js"></script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-131671634-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>

</html>