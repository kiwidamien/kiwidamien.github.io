<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Making a Python Package</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
  <link href="https://kiwidamien.github.io" rel="canonical" />

  <!-- Feed -->

  <link href="https://kiwidamien.github.io/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="https://kiwidamien.github.io/theme/css/code_blocks/monokai.css" rel="stylesheet">

    <!-- CSS specified by the user -->
    <link href="https://kiwidamien.github.io/assets/css/mystyle.css" type="text/css" rel="stylesheet" />

  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->


    <link href="https://kiwidamien.github.io/making-a-python-package.html" rel="canonical" />

        <meta name="description" content="This is the fourth in a series of blog posts where we go through the process of taking a collection of functions and turn them into a...">

        <meta name="author" content="Damien Martin">

        <meta name="tags" content="python">
        <meta name="tags" content="engineering">
        <meta name="tags" content="package">
        <meta name="tags" content="best-practices">
        <meta name="tags" content="unittest">
        <meta name="tags" content="pytest">

        <meta property="og:locale" content="" />
    <meta property="og:site_name" content="Stacked Turtles" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Stacked Turtles" />
    <meta property="og:description" content="View the blog." />
    <meta property="og:url" content="https://kiwidamien.github.io" />
      <meta property="og:image" content="https://kiwidamien.github.io/assets/images/tools.png" />

  <meta property="og:type" content="article">
            <meta property="article:author" content="https://kiwidamien.github.io/author/damien-martin.html">
  <meta property="og:url" content="https://kiwidamien.github.io/making-a-python-package.html">
  <meta property="og:title" content="Making a Python Package">
  <meta property="article:published_time" content="2019-01-02 22:30:00-08:00">
            <meta property="og:description" content="This is the fourth in a series of blog posts where we go through the process of taking a collection of functions and turn them into a...">

            <meta propery="og:image" content="https://kiwidamien.github.io/assets/images/cover_background/tool_background.svg">
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>
          <li><a href="https://kiwidamien.github.io/about.html" role="presentation">About this blog</a></li>
          <li><a href="http://slashdot.org" role="presentation">slashdot</a></li>
          <li><a href="https://thisismetis.com" role="presentation">metis</a></li>
          <li><a href="https://stackoverflow.com" role="presentation">stackoverflow</a></li>


    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" class="has-cover">
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="https://kiwidamien.github.io" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Making a Python Package</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="https://kiwidamien.github.io/author/damien-martin.html">Damien martin</a>
            | <time datetime="Wed 02 January 2019">Wed 02 January 2019</time>
        </span>
        <span class="post-meta">
          Filed under: <b><a href="https://kiwidamien.github.io/category/tools.html">Tools</a></b>
        </span>

        <!-- TODO : Modified check -->


    <div class="post-cover cover"
      style="background-image: url('assets/images/cover_background/tool_background.svg'); background-repeat: repeat; background-size: 100px 100px; background-color: rgb(240,180,82);">
      <div class="logoimg">
        <img src='https://kiwidamien.github.io/assets/images/icon/turtle.svg'/>
      </div>
      <div class="logoimg">
        <img src='assets/images/icon/tool_icon.png'/>
      </div>

</div>
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
		    <p>This post is part 1 of the "Making a Python Package" series:</p>
    		    <ol class="parts">
            	        <li class="active">
                          <a href='https://kiwidamien.github.io/making-a-python-package.html'>Making a Python Package</a>
                        </li>
            	        <li >
                          <a href='https://kiwidamien.github.io/making-a-python-package.html'>Making a Python Package</a>
                        </li>
            	        <li >
                          <a href='https://kiwidamien.github.io/making-a-python-package.html'>Making a Python Package</a>
                        </li>
            	        <li >
                          <a href='https://kiwidamien.github.io/making-a-python-package.html'>Making a Python Package</a>
                        </li>
                    </ol>
                <p>Note: To get the material for this blog post, visit the <a href="https://github.com/kiwidamien/Roman/tree/v0.4">v0.4 tag of Romans!</a> Github project. To get it locally, and assuming you cloned the previous version, run</p>
<div class="highlight"><pre><span></span><span class="c1"># clear last set of changes</span>
$ git reset --hard HEAD
<span class="c1"># checkout this version</span>
$ git checkout tags/v0.4
</pre></div>


<h3>To install</h3>
<p>To follow the steps in this tutorial, you will need to install <code>tox</code> and <code>pytest</code></p>
<div class="highlight"><pre><span></span>pip install tox pytest
</pre></div>


<h1>Making a Python Package IV: writing unit tests</h1>
<p>There are many developers that would complain about us writing tests as step 4. They would claim the <em>first</em> thing we should do is write tests that tell us what the functions <em>should</em> do, and only then write code to satisfy the tests. This is called <em>Test Driven Development</em> (TDD). If you are writing your first Python package, or are coming from a field like Data Science which is heavy on the EDA, you probably wrote some code and realized you could reuse it, rather than starting with the idea of creating reusable code. For that reason, I have put tests after the initial code has been written.</p>
<p>One important thing that we will come back to, however, is that we have to resist the temptation to write tests that duplicate the output of the code. Instead, we should start by asking ourselves "what <em>should</em> our code do in case X?" and write a test to match that.</p>
<h2>Creating the directory structure</h2>
<p>There are a few different places to put our tests, but I like having them outside my package directory. Our testing module, <code>pytest</code>, expects that
<em> files containing tests start with the word <code>test</code>
</em> functions containing tests start with the word <code>test</code></p>
<p>Go ahead and create the following files:
<em> <code>tests/test_roman.py</code>: to test the implementation of <code>roman/roman.py</code>
</em> <code>tests/test_temperature.py</code>: to test the implementation of <code>roman/temperature.py</code>
* <code>tests/__init__.py</code>: we leave this blank, but it is required to turn <code>tests</code> into a package (otherwise <code>pytest</code> doesn't process the files in the test directory).</p>
<p>Our directory structure should now look like this:</p>
<div class="highlight"><pre><span></span>roman_project
+-- roman
    +-- __init__.py
    +-- roman.py
    +-- temperature.py
+-- README.mdi
+-- setup.py
+-- tests
    +-- __init__.py
    +-- test_roman.py
    +-- test_temperature.py
</pre></div>


<h2>Creating our first test</h2>
<p>We will use the <a href="https://semaphoreci.com/community/tutorials/testing-python-applications-with-pytest">pytest</a> module to write our unit tests. The simplest tests are equality assertions, where we check that a function returns the value we expect. For example, we would want <code>roman.roman_string_to_int('V')</code> to return <code>5</code>. Put the following in <code>test/test_roman.py</code></p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">roman.roman</span> <span class="kn">import</span> <span class="n">roman_string_to_int</span><span class="p">,</span> <span class="n">int_to_roman_string</span>

<span class="k">def</span> <span class="nf">test_V_gets_converted_to_5</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">roman_string_to_int</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>


<p>At the top level directory, run </p>
<div class="highlight"><pre><span></span>$ pytest
</pre></div>


<p>and you should see output similar to the following</p>
<div class="highlight"><pre><span></span><span class="o">========================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=========================================================</span>
platform darwin -- Python <span class="m">3</span>.6.5, pytest-3.3.2, py-1.5.2, pluggy-0.6.0
rootdir: &lt;file location of package&gt;/roman_package, inifile:
collected <span class="m">1</span> item                                                                                                                                                                                 

tests/test_roman.py .                                                                                                          <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">======================================================</span> <span class="m">1</span> passed in <span class="m">0</span>.02 <span class="nv">seconds</span> <span class="o">======================================================</span>
</pre></div>


<p>This tells us that our test passed!</p>
<p>Let's change the test so that it fails. We will change the function to</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_V_gets_converted_to_6</span><span class="p">():</span>   <span class="c1"># this is wrong and should fail</span>
    <span class="k">assert</span> <span class="n">roman_string_to_int</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
</pre></div>


<p>Now the output is</p>
<div class="highlight"><pre><span></span><span class="o">========================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=========================================================</span>
platform darwin -- Python <span class="m">3</span>.6.5, pytest-3.3.2, py-1.5.2, pluggy-0.6.0
rootdir: &lt;location of file on drive&gt;/roman_package, inifile:
collected <span class="m">1</span> item                                                                                                                                                                                 

tests/test_roman.py F                                                                                                          <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==============================================================</span> <span class="nv">FAILURES</span> <span class="o">==============================================================</span>
_____________________________________________________ test_V_gets_converted_to_6 _____________________________________________________

    def test_V_gets_converted_to_6<span class="o">()</span>:   <span class="c1"># this is wrong and should fail</span>
&gt;       assert roman_string_to_int<span class="o">(</span><span class="s1">&#39;V&#39;</span><span class="o">)</span> <span class="o">==</span> <span class="m">6</span>
E       AssertionError: assert <span class="nv">5</span> <span class="o">==</span> <span class="m">6</span>
E        +  where <span class="nv">5</span> <span class="o">=</span> roman_string_to_int<span class="o">(</span><span class="s1">&#39;V&#39;</span><span class="o">)</span>

tests/test_roman.py:5: <span class="nv">AssertionError</span>
<span class="o">======================================================</span> <span class="m">1</span> failed in <span class="m">0</span>.04 <span class="nv">seconds</span> <span class="o">======================================================</span>
</pre></div>


<p>Note what the failure is telling us in some detail:
<em> The name of the function that failed (<code>test_V_gets_converted_to_6</code>)
</em> The code of the failing function
<em> That <code>roman_string_to_int('V')</code> actually evaluated to 5
</em> That <code>5 == 6</code> is not a true statment.</p>
<p>In this case, it is easy to see that our test is incorrect, because we deliberately made the test wrong to see what information we get. One of the key pieces of information is the name of the failing test. When naming test functions, it should be very clear exactly what is being tested. We should write names as questions: <code>test_if_V_is_converted_to_6</code> is a bad name, <code>test_V_gets_converted_to_6</code> is a good name. By reading the name of the test, you should know <em>exactly</em> what <em>should</em> happen as a result of the test. </p>
<p>For testing, you are encouraged to write long, verbose names. The usual "PEP 8" standards that claim you should have 79 characters per line are not applied to unit tests.</p>
<h2>Our second test: an assertion test</h2>
<p>What <em>should</em> <code>roman_string_to_int('Q')</code> return? Since 'Q' isn't a Roman numeral, our function should throw an error. Right now, it actually returns 0 -- we made the assumption when writing the function that we had a valid Roman numeral. Here is how we check for errors in <code>pytest</code>:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_char_not_in_MDCLXVI_raises_ValueError</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Q should raise value error, not in MDCLXVI&quot;</span><span class="p">):</span>
        <span class="n">roman_string_to_int</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>
</pre></div>


<p>Let's check it when running pytest (note that we have changed our other test back to <code>test_V_gets_converted_to_5</code>):</p>
<div class="highlight"><pre><span></span>$ <span class="nv">pytest</span>
<span class="o">========================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=========================================================</span>
platform darwin -- Python <span class="m">3</span>.6.5, pytest-3.3.2, py-1.5.2, pluggy-0.6.0
rootdir: /Users/damien/metis/roman_package, inifile:
collected <span class="m">2</span> items                                                                                                                                                                                

tests/test_roman.py .F                                                                                                         <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==============================================================</span> <span class="nv">FAILURES</span> <span class="o">==============================================================</span>
_____________________________________________ test_char_not_in_MDCLXVI_raises_ValueError _____________________________________________

    def test_char_not_in_MDCLXVI_raises_ValueError<span class="o">()</span>:
        with pytest.raises<span class="o">(</span>ValueError, <span class="nv">message</span><span class="o">=</span><span class="s2">&quot;Q should raise value error, not in MDCLXVI&quot;</span><span class="o">)</span>:
&gt;           roman_string_to_int<span class="o">(</span><span class="s1">&#39;Q&#39;</span><span class="o">)</span>
E           Failed: Q should raise value error, not in MDCLXVI

tests/test_roman.py:9: <span class="nv">Failed</span>
<span class="o">=================================================</span> <span class="m">1</span> failed, <span class="m">1</span> passed in <span class="m">0</span>.05 <span class="nv">seconds</span> <span class="o">=================================================</span>
</pre></div>


<p>We see the first test passed and the second one failed (hence <code>.F</code> after <code>tests/test_roman.py</code>).</p>
<p>These are the two most common tests that we will use.</p>
<h2>Writing tests</h2>
<p>Notice when we wrote the test for <code>roman_string_to_int('Q')</code>, we <strong>didn't</strong> look at what the code currently did (return 0) and declare that correct. We decided what the code should do (raise an error) and then wrote a test to see if our implementation did what we expected. In this case, it does not! This tells us we should probably go back and change <code>roman/roman.py</code> to raise an error when an illegal string is passed in.</p>
<p>It won't always be clear what the "right" behavior should be. For example, what should <code>roman_string_to_int('')</code> be? Here are two possibilities:
<em> The empty string contains nothing, so it should represent 0, or
</em> The Roman's had no concept or representation of 0, so <code>''</code> should raise a ValueError.</p>
<p>I could defend either of these positions, and when writing the function I didn't take a particular stand one way or the other. If this package is mostly used to label copyright dates, the case of zero coming up doesn't seem particularly likely, so we just have to make a decision. I won't tell you what decision I made, but I will tell you the name of the test I wrote: <code>test_empty_string_gives_zero</code>. Even though there isn't a "right" answer, someone reading my test code should be able to determine what I decided.</p>
<p>Let's look at another example. What should <code>roman_string_to_int('iii')</code> be? There are at least two reasonable answers here:
<em> Roman numerals should be considered case insensitive, so 'iii' should resolve to 3 (like it does in the Preface of books)
</em> Roman numerals were always used by the Romans in upper case, so 'i' (and other lower case letters) should be considered illegal.</p>
<p>Which would you decide to use?</p>
<p>Then there is the question of whether 'LLL' is legal. On the one hand, it is unambiguous: 'L' represents 50, so 'LLL' should be 150. On the other hand, we "should" take 'LLL' and reduce it to 'CL' as the "correct" or "usual" representation of 150. So if a user passes in a string like "LLL" or "IIIIIIIIII" do we evaluate it, or raise an error? What about "MMMMM"? The usual pattern is when we have 5 repeating powers of 10, we replace it with the next highest symbol (e.g. <code>IIIII-&gt;V, XXXXX-&gt;L, CCCCC-&gt;D</code>). Since there is nothing higher than <code>M</code>, do we declare Roman numerals incapable of representing numbers greater than 4999? Or do we accept that we can have as many <code>M</code>s as we want?</p>
<p>Let me list all of my tests in <code>tests/test_roman.py</code>. I claim you should be able to answer these questions after reading the name of the tests.</p>
<table>
<thead>
<tr>
<th>Test function name</th>
<th>Result (Pass/Fail)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>test_empty_string_gives_zero()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_char_not_in_MDCLXVI_raises_ValueError()</code></td>
<td>Fail</td>
</tr>
<tr>
<td><code>test_error_on_lower_case()</code></td>
<td>Fail</td>
</tr>
<tr>
<td><code>test_III_is_converted_to_3()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_IV_is_romaned_to_four()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_LLL_throws_ValueError()</code></td>
<td>Fail</td>
</tr>
<tr>
<td><code>test_CCC_gives_300()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_CI_allows_and_gives_101()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_IC_throws_ValueError()</code></td>
<td>Fail</td>
</tr>
<tr>
<td><code>test_5_gives_V()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_10_gives_X()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_50_gives_L()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_100_gives_C()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_500_gives_D()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_1000_gives_M()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_6000_is_MMMMMM()</code></td>
<td>Pass</td>
</tr>
<tr>
<td><code>test_2018_is_MMXVIII()</code></td>
<td>Pass</td>
</tr>
</tbody>
</table>
<p>You can probably think of other tests (e.g. trying to convert a fraction, or a negative number). The important thing here is that I didn't pick tests that would pass, I picked cases and determined what I wanted the behavior to be (or at least, made a choice about what it should be). It is now my job to rewrite the functions to make the tests pass.</p>
<p><strong>Note:</strong> If you are using the <code>v0.4</code> branch off github, you can see that I have also written unit tests for the temperature functions. I won't be covering them in these articles, but they are worth looking over.</p>
<h2>How testing helps</h2>
<p>Our original version of <code>roman/roman.py</code> was this:</p>
<div class="highlight"><pre><span></span><span class="c1"># We don&#39;t want these exposed to the end user,</span>
<span class="c1"># so lead with an underscore instead</span>
<span class="n">_ROMAN_SYMBOLS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;CM&#39;</span><span class="p">,</span> <span class="mi">900</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;CD&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;XC&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;IV&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">roman_string_to_int</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a numeral string representing a roman numeral to an integer.</span>

<span class="sd">    Args:</span>
<span class="sd">        numeral_string: represents a valid roman numeral. Must consist only of</span>
<span class="sd">                        M, D, C, L, X, V, and I.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An integer.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; roman_string_to_int(&#39;V&#39;)</span>
<span class="sd">        5</span>
<span class="sd">        &gt;&gt;&gt; roman_string_to_int(&#39;MMXIX&#39;)</span>
<span class="sd">        2019</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_ROMAN_SYMBOLS</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">numeral_string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">value</span>
            <span class="n">numeral_string</span> <span class="o">=</span> <span class="n">numeral_string</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">symbol</span><span class="p">):]</span>
    <span class="k">return</span> <span class="n">total</span>

<span class="k">def</span> <span class="nf">int_to_roman_string</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a positive integer into a Roman numeral.</span>

<span class="sd">    Args:</span>
<span class="sd">        number: a positive integer to be converted into a roman numeral</span>

<span class="sd">    Returns:</span>
<span class="sd">        The string representation of number.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; int_to_roman_string(5)</span>
<span class="sd">        &#39;V&#39;</span>
<span class="sd">        &gt;&gt;&gt; int_to_roman_string(2019)</span>
<span class="sd">        &#39;MMXIX&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_ROMAN_SYMBOLS</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="n">number</span><span class="o">//</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="n">symbol</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span> <span class="o">%</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>


<p>After rewriting it to make the tests work, I have the following:</p>
<div class="highlight"><pre><span></span><span class="c1"># We don&#39;t want these exposed to the end user,</span>
<span class="c1"># so lead with an underscore instead</span>
<span class="n">_ROMAN_SYMBOLS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;CM&#39;</span><span class="p">,</span> <span class="mi">900</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;CD&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;XC&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;IV&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">_ROMAN_POWERS_TEN</span> <span class="o">=</span> <span class="s1">&#39;MCXI&#39;</span>
<span class="n">_ROMAN_MID_POWERS</span> <span class="o">=</span> <span class="s1">&#39;DLV&#39;</span>
<span class="n">_ROMAN_ALL_SYMBOLS</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span> <span class="o">+</span> <span class="n">m</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_ROMAN_POWERS_TEN</span><span class="p">,</span>
                                                    <span class="n">_ROMAN_MID_POWERS</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;I&#39;</span>


<span class="k">def</span> <span class="nf">_contains_replacable</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Here are some simplifible rules. We will use I for powers of 10, and V for</span>
<span class="sd">    non-powers of 10:</span>
<span class="sd">      IIIII-&gt;V (5 powers of 10, except M, can be replaced with next non-power)</span>
<span class="sd">      IIII-&gt;IV (4 powers of 10, except M, can be replaced)</span>
<span class="sd">      VV-&gt;X (2 non-powers of 10 can be replaced with next highest power of 10)</span>
<span class="sd">      VIV-&gt;IX (nonpower, power, nonpower is replacable)</span>
<span class="sd">    Note all &quot;replaceable&quot; strings are in the same power (e.g. I,V/X,L/C,D)</span>

<span class="sd">    Raises a ValueError on finding a reducible substring.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_ROMAN_MID_POWERS</span><span class="p">,</span> <span class="n">_ROMAN_POWERS_TEN</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">for</span> <span class="n">non_power</span><span class="p">,</span> <span class="n">power_10</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
        <span class="n">reducibles</span> <span class="o">=</span> <span class="p">[</span><span class="n">power_10</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">power_10</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">non_power</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
                      <span class="n">non_power</span><span class="o">+</span><span class="n">power_10</span><span class="o">+</span><span class="n">non_power</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">reducible</span> <span class="ow">in</span> <span class="n">reducibles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reducible</span> <span class="ow">in</span> <span class="n">numeral_string</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;{numeral_string} is not a correctly</span>
<span class="s2">                                 formated roman numeral (it contains</span>
<span class="s2">                                 {reducible} as a substring, which is</span>
<span class="s2">                                 reducible)&quot;&quot;&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_all_characters_legal</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raises a ValueError if numeral_string contains a character not in MDCLXVI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">illegal_chars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_ROMAN_POWERS_TEN</span> <span class="o">+</span>
                                              <span class="n">_ROMAN_MID_POWERS</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">illegal_chars</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;{numeral_string} contains {illegal_chars}, which</span>
<span class="s2">                         are not allowed in Roman numerals&quot;&quot;&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_for_illegal_combos</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raises a ValueError if numeral_string contains an illegal combination.</span>
<span class="sd">    An illegal combination is any string where:</span>
<span class="sd">        - A digit with a smaller value appears before a larger value, with the</span>
<span class="sd">        exceptions of CM, CD, XC, XL, IX, IV (e.g. IC is illegal)</span>
<span class="sd">        - Two or more smaller values appear immediately before a larger value</span>
<span class="sd">        (e.g. CM is legal, but CCM is not)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">illegal_substrings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CCM&#39;</span><span class="p">,</span> <span class="s1">&#39;CCD&#39;</span><span class="p">,</span> <span class="s1">&#39;XXC&#39;</span><span class="p">,</span> <span class="s1">&#39;XXL&#39;</span><span class="p">,</span> <span class="s1">&#39;IIX&#39;</span><span class="p">,</span> <span class="s1">&#39;IIV&#39;</span><span class="p">]</span>
    <span class="n">exception_substrings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CM&#39;</span><span class="p">,</span> <span class="s1">&#39;CD&#39;</span><span class="p">,</span> <span class="s1">&#39;XC&#39;</span><span class="p">,</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="s1">&#39;IX&#39;</span><span class="p">,</span> <span class="s1">&#39;IV&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">illegal_substring</span> <span class="ow">in</span> <span class="n">illegal_substrings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">illegal_substring</span> <span class="ow">in</span> <span class="n">numeral_string</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;{numeral_string} is not a valid Roman numeral,</span>
<span class="s2">                             it contains the illegal substring</span>
<span class="s2">                             {illegal_substring}&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">exception_substring</span> <span class="ow">in</span> <span class="n">exception_substrings</span><span class="p">:</span>
        <span class="n">numeral_string</span> <span class="o">=</span> <span class="n">numeral_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">exception_substring</span><span class="p">,</span>
                                                <span class="n">exception_substring</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">current_char</span><span class="p">,</span> <span class="n">next_char</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">,</span> <span class="n">numeral_string</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">curr_index</span> <span class="o">=</span> <span class="n">_ROMAN_ALL_SYMBOLS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">current_char</span><span class="p">)</span>
        <span class="n">next_index</span> <span class="o">=</span> <span class="n">_ROMAN_ALL_SYMBOLS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">next_char</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">curr_index</span> <span class="o">&gt;</span> <span class="n">next_index</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;String contains an illegal combination of</span>
<span class="s2">                             characters&quot;&quot;&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_validate_string</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raises an error if string is not valid. Interal use only.&quot;&quot;&quot;</span>
    <span class="n">_check_all_characters_legal</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">)</span>
    <span class="n">_contains_replacable</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">)</span>
    <span class="n">_check_for_illegal_combos</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_valid_roman_numeral</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determines if numeral_string is a valid Roman numeral or not&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_validate_string</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>


<span class="k">def</span> <span class="nf">roman_string_to_int</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a numeral string representing a roman numeral to an integer.</span>

<span class="sd">    Args:</span>
<span class="sd">        numeral_string: represents a valid roman numeral. Must consist only of</span>
<span class="sd">                        M, D, C, L, X, V, and I.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An integer.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; roman_string_to_int(&#39;V&#39;)</span>
<span class="sd">        5</span>
<span class="sd">        &gt;&gt;&gt; roman_string_to_int(&#39;MMXIX&#39;)</span>
<span class="sd">        2019</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if passed symbols other than MDCLXVI, or passed illegal</span>
<span class="sd">                    combinations (e.g. IC), or passed reducible combinations</span>
<span class="sd">                    (e.g. LLL)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_validate_string</span><span class="p">(</span><span class="n">numeral_string</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_ROMAN_SYMBOLS</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">numeral_string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">value</span>
            <span class="n">numeral_string</span> <span class="o">=</span> <span class="n">numeral_string</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">symbol</span><span class="p">):]</span>
    <span class="k">return</span> <span class="n">total</span>


<span class="k">def</span> <span class="nf">int_to_roman_string</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a positive integer into a Roman numeral.</span>

<span class="sd">    Args:</span>
<span class="sd">        number: a positive integer to be converted into a roman numeral.</span>
<span class="sd">                Will use integer part if passed a float.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The string representation of number.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; int_to_roman_string(5)</span>
<span class="sd">        &#39;V&#39;</span>
<span class="sd">        &gt;&gt;&gt; int_to_roman_string(2019)</span>
<span class="sd">        &#39;MMXIX&#39;</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if passed a negative number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;{number} is negative, cannot convert to Roman</span>
<span class="s2">                         numeral&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_ROMAN_SYMBOLS</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="n">number</span><span class="o">//</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="n">symbol</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span> <span class="o">%</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>


<p>It is a lot longer, but notice that
<em> the docstrings have been updated
</em> there are meaningful error messages
* we have a new user level function <code>is_valid_roman_numeral</code></p>
<p>Looking at this code, it is clear that we could use <code>_ROMAN_MID_POWERS</code> and <code>ROMAN_POWERS_TEN</code> to generate <code>_ROMAN_SYMBOLS</code>, or even do away with the table altogether. With the tests in place, we are free to try and rearrange this code. When we are done, we just rerun the tests and check our changes didn't break anything.</p>
<h2>Tooling: <code>tox</code></h2>
            </section>

            <section class="post-info">
                <div class=a"post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Making a Python Package&amp;url=https://kiwidamien.github.io/making-a-python-package.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://kiwidamien.github.io/making-a-python-package.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=https://kiwidamien.github.io/making-a-python-package.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="https://kiwidamien.github.io/tag/python.html">python</a><a href="https://kiwidamien.github.io/tag/engineering.html">engineering</a><a href="https://kiwidamien.github.io/tag/package.html">package</a><a href="https://kiwidamien.github.io/tag/best-practices.html">best-practices</a><a href="https://kiwidamien.github.io/tag/unittest.html">unittest</a><a href="https://kiwidamien.github.io/tag/pytest.html">pytest</a>                </aside>

                <div class="clear"></div>

                <aside class="post-author">
                        <figure class="post-author-avatar">
                            <img src="../assets/images/avatar.png" alt="Damien martin" />
                        </figure>
                    <div class="post-author-bio">
                        <h4 class="post-author-name"><a href="https://kiwidamien.github.io/author/damien-martin.html">Damien martin</a></h4>
                            <p class="post-author-about">I am a data scientist with an interest in what drives the world. Background in Physics, Math, and Computer Science. Interested in Algorithms, Games, Books, Music, and Martial Arts. That is, when I am not off taking pictures somewhere! </p>
                            <span class="post-author-location"><i class="ic ic-location"></i> USA</span>
                            <span class="post-author-website"><a href="http://kiwidamien.github.io"><i class="ic ic-link"></i> Website</a></span>
                    </div>
                    <div class="clear"></div>
                </aside>

                </section>


                <aside class="post-nav">
                    <a class="post-nav-next" href="https://kiwidamien.github.io/making-a-python-package.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-left"></i>
                                <h2 class="post-nav-title">Making a Python Package</h2>
                            <p class="post-nav-excerpt">This is the third in a series of blog posts where we go through the process of taking...</p>
                        </section>
                    </a>
                    <a class="post-nav-prev" href="https://kiwidamien.github.io/derivations-and-conjugate-priors-proportions.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-right"></i>
                                <h2 class="post-nav-title">Derivations and Conjugate Priors (proportions)</h2>
                            <p class="post-nav-excerpt">This article contains derivations when applying the shrinkage methods of empirical...</p>
                        </section>
                    </a>
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>
  
  </section>

  <script type="text/javascript" src="https://kiwidamien.github.io/theme/js/script.js"></script>

</body>
</html>